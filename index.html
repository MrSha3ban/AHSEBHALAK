<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title> Ahsebhalak |  Logistics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --bg-deep: #050608;
            --panel-glass: rgba(20, 24, 30, 0.9);
            --accent-cyan: #00f2ff;
            --accent-green: #00ff88;
            --danger: #ff4d4d;
            --border-glow: rgba(0, 242, 255, 0.2);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            margin: 0;
            background-color: var(--bg-deep);
            color: #fff;
            font-family: var(--font-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© - ØªØµÙ…ÙŠÙ… Ø²Ø¬Ø§Ø¬ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ */
        #control-panel {
            width: 420px;
            background: var(--panel-glass);
            backdrop-filter: blur(25px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
            box-shadow: 10px 0 50px rgba(0,0,0,0.8);
            overflow-y: auto;
        }

        .brand {
            border-right: 4px solid var(--accent-cyan);
            padding-right: 15px;
            margin-bottom: 10px;
        }

        .brand h1 { margin: 0; font-size: 1.6rem; letter-spacing: 1px; text-transform: uppercase; }
        .brand span { font-weight: 200; color: var(--accent-cyan); }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
        .module {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 18px;
            border-radius: 12px;
            transition: 0.3s;
        }

        .module h3 {
            margin: 0 0 12px 0;
            font-size: 0.85rem;
            color: var(--accent-cyan);
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙƒØµÙÙˆÙ ØªØ­Øª Ø¨Ø¹Ø¶Ù‡Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ */
        .input-grid { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label { font-size: 0.75rem; color: #888; }

        input, select {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #3d444d;
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            outline: none;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        input:focus { border-color: var(--accent-cyan); box-shadow: 0 0 10px var(--border-glow); }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-primary { background: var(--accent-cyan); color: #000; }
        .btn-success { 
            background: linear-gradient(135deg, var(--accent-green), #00d4ff); 
            color: #000; font-size: 1.1rem; margin-top: 10px;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }

        .btn:hover { transform: translateY(-3px); filter: brightness(1.1); }

        /* Ø¬Ø¯ÙˆÙ„ Ù…Ø§Ù†ÙŠÙØ³Øª Ø§Ù„Ø´Ø­Ù†Ø© */
        #manifest {
            width: 100%;
            margin-top: 15px;
            font-size: 0.8rem;
            border-collapse: collapse;
        }

        #manifest th { color: #666; text-align: right; padding: 10px; border-bottom: 1px solid #333; }
        #manifest td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§ÙÙŠØ© (HUD) */
        #hud-container {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .hud-card {
            background: rgba(10, 12, 15, 0.85);
            backdrop-filter: blur(15px);
            border-right: 4px solid var(--accent-cyan);
            padding: 15px 25px;
            border-radius: 6px;
            min-width: 180px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .hud-label { display: block; font-size: 0.7rem; color: var(--accent-cyan); font-weight: bold; text-transform: uppercase; }
        .hud-value { font-size: 1.8rem; font-weight: 300; color: #fff; }

        #canvas-container { flex: 1; position: relative; cursor: move; }
    </style>
</head>
<body>

<div id="control-panel">
    <div class="brand">
        <h1>Ahsebhalak<span>Logistics</span></h1>
        <small style="color: #666;">High-Efficiency Cargo Engine </small>
    </div>

    <div class="module">
        <h3><span>ğŸšš</span> Ù†ÙˆØ¹ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø­Ù†</h3>
        <select id="cont-type" onchange="initContainer()" style="width: 100%;">
            <option value="590,235,239">20' Standard (5.9m)</option>
            <option value="1203,235,239">40' Standard (12.03m)</option>
            <option value="1203,235,269">40' High Cube (12.03m)</option>
        </select>
    </div>

    <div class="module">
        <h3><span>ğŸ“¦</span> Ø¥Ø¶Ø§ÙØ© ÙƒØ±Ø§ØªÙŠÙ† Ø§Ù„Ù…Ù„Ø§Ø¨Ø³</h3>
        <div class="input-grid">
            <div class="input-group">
                <label>Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
                <input type="number" id="l" value="60">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)</label>
                <input type="number" id="w" value="40">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ø³Ù…)</label>
                <input type="number" id="h" value="30">
            </div>
            <div class="input-group">
                <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø´Ø­Ù†Ù‡Ø§</label>
                <input type="number" id="qty" value="20">
            </div>
            <div class="input-group">
                <label>Ù„ÙˆÙ† Ø§Ù„ÙƒØ±ØªÙˆÙ†Ø© Ù„Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¨ØµØ±ÙŠ</label>
                <input type="color" id="clr" value="#00f2ff" style="height: 45px; padding: 2px;">
            </div>
        </div>
        <button class="btn btn-primary" onclick="addToPackingList()" style="margin-top: 15px;">Ø¥Ø¶Ø§ÙØ© Ù„Ø¨ÙŠØ§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
        
        <table id="manifest">
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‚Ø§Ø³ (LWH)</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ù„ÙˆÙ†</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="list-body"></tbody>
        </table>
    </div>

    <button class="btn btn-success" onclick="startPacking()">ØªØ­Ù„ÙŠÙ„ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø´Ø­Ù†Ø©  ğŸš€</button>
    <button class="btn" style="background: rgba(255,255,255,0.05); color: #fff;" onclick="location.reload()">ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙˆÙŠØ©</button>
     <button class="btn" style="background: rgba(255,255,255,0.05); color: #fff;" onclick="location.reload()">ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙˆÙŠØ©</button>
      
                   
</div>

<div id="canvas-container">
    <div id="hud-container">
        <div class="hud-card">
            <span class="hud-label">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„ÙƒØ±Ø§ØªÙŠÙ†</span>
            <span id="stat-count" class="hud-value">0</span>
        </div>
        <div class="hud-card" style="border-right-color: var(--accent-green);">
            <span class="hud-label">ÙƒÙØ§Ø¡Ø© Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ©</span>
            <span id="stat-eff" class="hud-value">0%</span>
        </div>
        <div class="hud-card">
            <span class="hud-label">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (mÂ³)</span>
            <span id="stat-vol" class="hud-value">0.00</span>
        </div>
    </div>
</div>

<script>
    let scene, camera, renderer, controls, containerMesh, gridHelper;
    let packingList = [];
    let containerDim = { l: 590, w: 235, h: 239 };

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050608);

        camera = new THREE.PerspectiveCamera(45, (window.innerWidth - 420) / window.innerHeight, 1, 10000);
        camera.position.set(1200, 1000, 1200);
        
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth - 420, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        
        // Ø¥Ø¶Ø§Ø¡Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù„Ø¹Ù…Ù‚
        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 0.6);
        sun.position.set(500, 1500, 750);
        scene.add(sun);

        initContainer();
        animate();
    }

    function initContainer() {
        if (containerMesh) scene.remove(containerMesh);
        if (gridHelper) scene.remove(gridHelper);

        const d = document.getElementById('cont-type').value.split(',').map(Number);
        containerDim = { l: d[0], w: d[1], h: d[2] };
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© (Wireframe)
        const geo = new THREE.BoxGeometry(containerDim.l, containerDim.h, containerDim.w);
        const edges = new THREE.EdgesGeometry(geo);
        containerMesh = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x00f2ff, transparent: true, opacity: 0.3 }));
        containerMesh.position.y = containerDim.h / 2;
        scene.add(containerMesh);

        // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø¨ÙƒØ© Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ÙŠØ© (Grid)
        gridHelper = new THREE.GridHelper(Math.max(d[0], d[1]) * 1.5, 40, 0x222222, 0x111111);
        scene.add(gridHelper);
    }

    function addToPackingList() {
        const l = parseInt(document.getElementById('l').value);
        const w = parseInt(document.getElementById('w').value);
        const h = parseInt(document.getElementById('h').value);
        const qty = parseInt(document.getElementById('qty').value);
        const clr = document.getElementById('clr').value;

        if(!l || !qty) return;

        packingList.push({ l, w, h, qty, clr, id: Date.now() });
        updateTable();
    }

    function updateTable() {
        const tbody = document.getElementById('list-body');
        tbody.innerHTML = packingList.map(item => `
            <tr>
                <td style="font-family: monospace;">${item.l}x${item.w}x${item.h}</td>
                <td><b>${item.qty}</b></td>
                <td><div style="width:25px; height:10px; border-radius:4px; background:${item.clr}"></div></td>
                <td><button onclick="removeItem(${item.id})" style="color:var(--danger); background:none; border:none; cursor:pointer;">âœ•</button></td>
            </tr>
        `).join('');
    }

    function removeItem(id) {
        packingList = packingList.filter(i => i.id !== id);
        updateTable();
    }

    function startPacking() {
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡
        scene.children = scene.children.filter(c => c.name !== "carton_mesh" && c.name !== "carton_edge");
        
        let loadedCount = 0;
        let usedVol = 0;
        
        // 1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù‚Ø·Ø¹ ÙØ±Ø¯ÙŠØ©
        let flatItems = [];
        packingList.forEach(p => {
            for(let i=0; i<p.qty; i++) flatItems.push({...p});
        });

        // 2. Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© (Ø§Ù„Ø£ÙƒØ¨Ø± Ø­Ø¬Ù…Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø£Ø³ÙÙ„)
        // Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† Ø£Ù† Ø£Ø«Ù‚Ù„ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ† ØªÙƒÙˆÙ† Ù‡ÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
        flatItems.sort((a, b) => (b.l * b.w * b.h) - (a.l * a.w * a.h));

        let curX = -containerDim.l/2;
        let curY = 0;
        let curZ = -containerDim.w/2;
        let maxRowW = 0;
        let maxLayerH = 0;

        // 3. Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Øµ Ø§Ù„Ø­Ø±ÙƒÙŠ
        for (let item of flatItems) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯
            if (curX + item.l > containerDim.l/2) {
                curX = -containerDim.l/2;
                curZ += maxRowW;
                maxRowW = 0;
            }
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø·Ø¨Ù‚Ø© Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯Ø©
            if (curZ + item.w > containerDim.w/2) {
                curZ = -containerDim.w/2;
                curY += maxLayerH;
                maxLayerH = 0;
            }
            // Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù†Ø¯ Ø¨Ù„ÙˆØº Ø§Ù„Ø³Ù‚Ù
            if (curY + item.h > containerDim.h) break;

            const boxGeo = new THREE.BoxGeometry(item.l-0.8, item.h-0.8, item.w-0.8);
            const mat = new THREE.MeshPhongMaterial({ 
                color: item.clr, 
                shininess: 40,
                transparent: true,
                opacity: 0.9
            });
            const mesh = new THREE.Mesh(boxGeo, mat);
            mesh.name = "carton_mesh";
            
            mesh.position.set(curX + item.l/2, curY + item.h/2, curZ + item.w/2);
            scene.add(mesh);

            // Ø¥Ø¶Ø§ÙØ© Ø­ÙˆØ§Ù Ø³ÙˆØ¯Ø§Ø¡ Ù„ØªÙˆØ¶ÙŠØ­ Ø­Ø¯ÙˆØ¯ ÙƒÙ„ ÙƒØ±ØªÙˆÙ†Ø© Ø¨ØµØ±ÙŠØ§Ù‹
            const edgeGeo = new THREE.EdgesGeometry(boxGeo);
            const line = new THREE.LineSegments(edgeGeo, new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3 }));
            line.position.copy(mesh.position);
            line.name = "carton_edge";
            scene.add(line);

            curX += item.l;
            maxRowW = Math.max(maxRowW, item.w);
            maxLayerH = Math.max(maxLayerH, item.h);
            usedVol += (item.l * item.w * item.h);
            loadedCount++;
        }

        // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© (HUD)
        const totalCap = containerDim.l * containerDim.w * containerDim.h;
        document.getElementById('stat-count').innerText = loadedCount;
        document.getElementById('stat-eff').innerText = ((usedVol/totalCap)*100).toFixed(1) + "%";
        document.getElementById('stat-vol').innerText = (usedVol/1000000).toFixed(2);
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }

    init();

    // Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ù…ØªØ¬Ø§ÙˆØ¨Ø§Ù‹ Ù…Ø¹ Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
    window.addEventListener('resize', () => {
        camera.aspect = (window.innerWidth - 420) / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth - 420, window.innerHeight);
    });
</script>
</body>
</html>
